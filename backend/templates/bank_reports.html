<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Reports - Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Poppins',sans-serif; background:#f0f2f5; }
        header { background:linear-gradient(135deg,#0f52ba 0%,#9b59b6 100%); color:white; padding:1rem; }
        header h1 { font-size:1.5rem; }
        .container { max-width:1200px; margin:2rem auto; padding:0 1rem; }
        .stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1.5rem; margin:2rem 0; }
        .stat-card { background:white; padding:2rem; border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
        .stat-card h3 { color:#0f52ba; font-size:0.9rem; margin-bottom:0.5rem; }
        .stat-card .number { font-size:2.5rem; font-weight:700; color:#333; }
        .stat-card .subtext { font-size:0.85rem; color:#666; margin-top:0.5rem; }
        table { width:100%; background:white; border-collapse:collapse; border-radius:1rem; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.1); margin:2rem 0; }
        thead { background:#0f52ba; color:white; }
        th, td { padding:1rem; text-align:left; border-bottom:1px solid #eee; }
        th { font-weight:600; }
        tr:hover { background:#f9f9f9; }
        .back-btn, .export-btn { display:inline-block; padding:0.8rem 1.5rem; background:#0f52ba; color:white; text-decoration:none; border-radius:0.5rem; margin-bottom:1rem; margin-right:0.5rem; border:none; cursor:pointer; }
        .back-btn:hover, .export-btn:hover { background:#063fa3; }
        .export-section { margin:2rem 0; }
        .export-label { font-weight:600; color:#333; margin-bottom:1rem; display:block; }
    </style>
</head>
<body>
<header>
    <h1><i class="fas fa-chart-bar"></i> Bank Reports & Analytics</h1>
</header>
<div class="container">
    <a href="/admin" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Admin</a>
    
    <div class="export-section">
        <span class="export-label"><i class="fas fa-download"></i> Export Reports:</span>
        <a href="/export/members" class="export-btn"><i class="fas fa-file-csv"></i> Members CSV</a>
        <a href="/export/loans" class="export-btn"><i class="fas fa-file-csv"></i> Loans CSV</a>
        <a href="/export/deposits" class="export-btn"><i class="fas fa-file-csv"></i> Deposits CSV</a>
        <a href="/export/transactions" class="export-btn"><i class="fas fa-file-csv"></i> Transactions CSV</a>
        <a href="/export/bank-report" class="export-btn"><i class="fas fa-file-csv"></i> Full Report CSV</a>
    </div>
    
    <h2 style="margin-top:2rem; margin-bottom:1rem;">Bank Overview</h2>
    <div class="stats">
        <div class="stat-card">
            <h3>Total Members</h3>
            <div class="number">{{ total_members }}</div>
            <div class="subtext">Approved members</div>
        </div>
        <div class="stat-card">
            <h3>Active Loans</h3>
            <div class="number">{{ total_loans }}</div>
            <div class="subtext">₹{{ "{:.0f}".format(total_loan_amount) }}</div>
        </div>
        <div class="stat-card">
            <h3>Fixed Deposits</h3>
            <div class="number">{{ total_fds }}</div>
            <div class="subtext">₹{{ "{:.0f}".format(total_fd_amount) }}</div>
        </div>
        <div class="stat-card">
            <h3>Share Holdings</h3>
            <div class="number">{{ total_shares }}</div>
            <div class="subtext">₹{{ "{:.0f}".format(total_share_amount) }}</div>
        </div>
    </div>
    
    <h2 style="margin-top:2rem; margin-bottom:1rem;">Profit & Loss Summary</h2>
    <div style="background:white; padding:2rem; border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.1); margin-bottom:2rem;">
        <p><strong>Total Loans Disbursed:</strong> ₹{{ "{:.2f}".format(total_loan_amount) }}</p>
        <p><strong>Total Deposits Received:</strong> ₹{{ "{:.2f}".format(total_fd_amount + total_share_amount) }}</p>
        <p style="margin-top:1rem; padding-top:1rem; border-top:1px solid #eee;">
            <strong style="color:#27ae60;">Net Position: ₹{{ "{:.2f}".format(total_fd_amount + total_share_amount - total_loan_amount) }}</strong>
        </p>
    </div>
    
    <h2 style="margin-bottom:1rem;">Recent Transactions</h2>
    {% if transactions %}
    <table>
        <thead>
            <tr>
                <th>Transaction ID</th>
                <th>Type</th>
                <th>Amount (₹)</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for txn in transactions %}
            <tr>
                <td>#{{ txn.id }}</td>
                <td>{{ txn.type }}</td>
                <td>₹{{ "{:.2f}".format(txn.amount) }}</td>
                <td>{{ txn.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align:center; color:#666; padding:2rem;">No transactions yet.</p>
    {% endif %}
</div>
</body>
</html>